/**
 *
 * @name:  表格筛选扩展
 * @author: yelog
 * @link: https://github.com/yelog/layui-soul-table
 * @license: MIT
 * @version: v1.6.2
 */
layui.define(["table","form","laydate","util","excel","laytpl"],function(e){var R,B,q,l,a,U=layui.jquery,z=layui.table,j=layui.form,f=layui.laydate,E=layui.laytpl,y=layui.util,Y=layui.excel,A={},H="SOUL_ROW_INDEX",M={},J="layui-hide",i=1,G=[void 0,"",null],X={},V={},$={},_={eq:"等于",ne:"≠ 不等于",gt:"> 大于",ge:"≥ 大于等于",lt:"< 小于",le:"≤ 小于等于",contain:"包含",notContain:"不包含",start:"以...开头",end:"以...结尾",null:"为空",notNull:"不为空"},b={all:"全部",yesterday:"昨天",thisWeek:"本周",lastWeek:"上周",thisMonth:"本月",thisYear:"今年"},K=["column","data","condition","editCondition","excel"],p={column:"soul-column",data:"soul-dropList",condition:"soul-condition",editCondition:"soul-edit-condition",excel:"soul-export",clearCache:"soul-clear-cache"},u={in:"data",condition:"condition",date:"condition"},c={data:{mode:"condition",type:"eq",value:""},condition:{mode:"in",values:[]}};e("tableFilter",{destroy:function(e){if(e)if(Array.isArray(e))for(var i=0;i<e.length;i++)t(e[i]);else t(e);function t(e){e&&(e=e.config.id,U("#soul-filter-list"+e).remove(),U("#soulCondition"+e).remove(),U("#soulDropList"+e).remove(),delete A[e],delete X[e],delete $[e])}},clearFilter:function(e){"string"==typeof e&&(e=$[e]),X[e.id]&&X[e.id].filterSos&&"[]"!==X[e.id].filterSos&&(X[e.id].filterSos="[]",this.soulReload(e,!0),$[e.id].where&&$[e.id].where.filterSos&&"[]"!==$[e.id].where.filterSos&&($[e.id].where.filterSos="[]"))},render:function(m){var v=this,t=U(m.elem),e=t.next().children(".layui-table-box").children(".layui-table-main"),i=t.next().children(".layui-table-box").children(".layui-table-header").children("table"),l=t.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),a=t.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),b=m.id,g=v.getCompleteCols(m.cols),o=m.filter&&m.filter.items||K,d=!1,n=!1,s=void 0===m.excel||!(!m.excel||void 0!==m.excel.on&&!m.excel.on)&&m.excel;for(x=0;x<g.length;x++)g[x].field&&g[x].filter&&(d=!0,0===i.find('th[data-field="'+g[x].field+'"]').children().children(".soul-table-filter").length&&(n=!0,0<i.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").length?(i.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").hide(),i.find('th[data-field="'+g[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" lay-sort="'+i.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):i.find('th[data-field="'+g[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'),0<l.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").length?(l.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").hide(),l.find('th[data-field="'+g[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" lay-sort="'+l.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):l.find('th[data-field="'+g[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'),0<a.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").length?(a.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").hide(),a.find('th[data-field="'+g[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" lay-sort="'+a.find('th[data-field="'+g[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):a.find('th[data-field="'+g[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(g[x].filter.items?g[x].filter.items.join(","):"")+'" data-column="'+g[x].field+'" '+(void 0===g[x].filter.split?"":'data-split="'+g[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')));if($[m.id]=m,V[m.id]=d){if(m.filter&&void 0!==m.filter.bottom&&!m.filter.bottom||0!==t.next().children(".soul-bottom-contion").length||(t.next().children(".layui-table-box").after('<div class="soul-bottom-contion"><div class="condition-items"></div><div class="editCondtion"><a class="layui-btn layui-btn-primary">编辑筛选条件</a></div></div>'),y=t.next().children(".layui-table-box").children(".layui-table-body").outerHeight()-t.next().children(".soul-bottom-contion").outerHeight(),m.page&&t.next().children(".layui-table-page").hasClass("layui-hide")&&(y+=t.next().children(".layui-table-page").outerHeight()),t.next().children(".layui-table-box").children(".layui-table-body").css("height",y),y=y-v.getScrollWidth(e[0]),e=e.children("table").height(),t.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").css("height",y<=e?y:"auto"),t.next().children(".soul-bottom-contion").children(".condition-items").css("width",t.next().children(".soul-bottom-contion").width()-t.next().children(".soul-bottom-contion").children(".editCondtion").width()+"px"),t.next().children(".soul-bottom-contion").children(".editCondtion").children("a").on("click",function(){v.showConditionBoard(m)})),!n||A[m.id]||m.isSoulFrontFilter)return A[m.id]=!1,m.isSoulFrontFilter=!1,!m.url&&m.page&&m.data&&m.data.forEach(function(e){for(x=0;x<M[m.id].length;x++)if(M[m.id][x][H]===e[H]){M[m.id][x]=e;break}}),void this.bindFilterClick(m);if(!m.url&&m.page&&m.data&&m.data.length>m.limit&&layui.each(m.data,function(e,i){i[m.indexName]=e}),m.url&&!m.page?M[m.id]=layui.table.cache[m.id]:M[m.id]=m.data||layui.table.cache[m.id],M[m.id].forEach(function(e,i){e[H]=i}),m.filter&&m.filter.clearFilter){if(m.where&&m.where.filterSos&&0<JSON.parse(m.where.filterSos).length)return m.where.filterSos="[]",X[m.id]=m.where||{},void v.soulReload(m,!1);X[m.id]=m.where||{}}else{if((void 0===m.url||!m.page||void 0===m.where.filterSos)&&X[m.id]&&0<JSON.parse(X[m.id].filterSos||"[]").length)return m.where.filterSos=X[m.id].filterSos,X[m.id]=m.where,void v.soulReload(m,!1);X[m.id]=m.where||{}}if(0===U("#soul-filter-list"+b).length){void 0!==m.soulSort&&!m.soulSort||(void 0===t.attr("lay-filter")&&t.attr("lay-filter",b),z.on("sort("+t.attr("lay-filter")+")",function(e){m.limit=$[m.id].limit,m.url&&m.page?(X[m.id].field=e.field,X[m.id].order=e.type,A[m.id]=!0,z.render(U.extend(m,{initSort:e,where:X[m.id],page:{curr:1}}))):!m.url&&m.page&&("asc"===e.type?M[m.id]=layui.sort(M[m.id],e.field):"desc"===e.type?M[m.id]=layui.sort(M[m.id],e.field,!0):M[m.id]=layui.sort(M[m.id],m.indexName),m.initSort=e,m.page={curr:1},v.soulReload(m,!1))}));var r=[],u={column:'<li class="soul-column"><i class="layui-icon layui-icon-table"></i> 表格列 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',data:'<li class="soul-dropList"><i class="soul-icon soul-icon-drop-list"></i> 筛选数据 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',condition:'<li class="soul-condition"><i class="soul-icon soul-icon-query"></i> 筛选条件 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',editCondition:'<li class="soul-edit-condition"><i class="layui-icon layui-icon-edit"></i> 编辑筛选条件 </li>',excel:'<li class="soul-export"><i class="soul-icon soul-icon-download"></i> 导出excel </li>',clearCache:'<li class="soul-clear-cache"><i class="layui-icon layui-icon-delete"></i> 清除缓存 </li>'};for(r.push('<div id="soul-filter-list'+b+'"><form action="" class="layui-form" lay-filter="orm"><ul id="main-list'+b+'" style="display: none">'),r.push('<li class="soul-sort" data-value="asc" ><i class="soul-icon soul-icon-asc"></i> 升序排列 </li>'),r.push('<li class="soul-sort" data-value="desc"  style="border-bottom: 1px solid #e6e6e6"><i class="soul-icon soul-icon-desc"></i> 降序排列 </li>'),x=0;x<K.length;x++)"excel"===K[x]&&!s||r.push(u[K[x]]);r.push('</ul><ul id="soul-columns'+b+'" style="display: none;">');for(var c={},x=0;x<g.length;x++)"checkbox"!==g[x].type&&g[x].field?(r.push('<li data-value="'+g[x].field+'" data-key="'+x+'"><input type="checkbox" value="'+m.index+"-"+g[x].key+'" title="'+g[x].title+'" data-fixed="'+(g[x].fixed||"")+'" lay-skin="primary" lay-filter="changeColumns'+b+'" '+(g[x].hide?"":"checked")+"></li>"),g[x].filter&&g[x].filter.type&&(g[x].filter.field?c[g[x].filter.field]=g[x].filter.type:c[g[x].field]=g[x].filter.type)):r.push('<li class="layui-hide"><input type="checkbox" title="'+g[x].title+'" /></li>');2!==JSON.stringify(c).length&&(m.where.tableFilterType=JSON.stringify(c)),r.push('</ul><div id="soul-dropList'+b+'" style="display: none"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"></div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;</i> 全选</div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;</i> 清空</div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;</i>反选</div></div><ul></ul></div>'),r.push('<ul id="soul-condition'+b+'" style="display: none;"></ul></form></div>'),U("body").append(r.join(""));var h=!0;j.on("checkbox(changeColumns"+b+")",function(e){h=!1;var i=e.value;for(e.elem.checked?t.next().find("[data-key="+i+"]").removeClass(J):t.next().find("[data-key="+i+"]").addClass(J),x=0;x<m.cols.length;x++)for(D=0;D<m.cols[x].length;D++)m.index+"-"+m.cols[x][D].key===i&&(m.cols[x][D].hide=!e.elem.checked);layui.soulTable&&layui.soulTable.fixTableRemember(m),t.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr.childTr").children("td").attr("colspan",t.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th:visible").length),z.resize(b)}),U("#soul-columns"+b+">li[data-value]").on("click",function(){U(this).find(":checkbox").is(":disabled")||(h&&U(this).find("div.layui-form-checkbox").trigger("click"),h=!0)}),U("#soul-dropList"+b+" .check [data-type]").on("click",function(){switch(U(this).data("type")){case"all":U(this).parents("#soul-dropList"+b).find("input[type=checkbox]:not(:checked)").prop("checked",!0);break;case"reverse":U(this).parents("#soul-dropList"+b).find("input[type=checkbox]").each(function(){U(this).prop("checked",!U(this).prop("checked"))});break;case"none":U(this).parents("#soul-dropList"+b).find("input[type=checkbox]:checked").prop("checked",!1)}return j.render("checkbox","orm"),v.updateDropList(m,U("#main-list"+b).data("field")),!1}),U("#soul-dropList"+b+" .filter-search input").on("input",function(){var e=U(this).val();""===e?U("#soul-dropList"+b+">ul>li").show():(U("#soul-dropList"+b+">ul>li").hide(),U("#soul-dropList"+b+'>ul>li[data-value*="'+e.toLowerCase()+'"]').show())}),U("#main-list"+b+" .soul-column").on("mouseover",function(e){for(v.hideDropList(m),v.hideCondition(m),e.stopPropagation(),R&&clearTimeout(R),g=v.getCompleteCols(m.cols),x=0;x<g.length;x++)U("#soul-columns"+b).find('li[data-value="'+g[x].field+'"]>input').prop("checked",!g[x].hide);var i;j.render("checkbox","orm"),U("#soul-columns"+b).show(),e=U(this).parent().offset().left+U(this).parent().width()+U("#soul-columns"+b).width()<document.body.clientWidth?(i=U(this).parent().offset().left+U(this).parent().width(),"fadeInLeft"):(i=U(this).parent().offset().left-U("#soul-columns"+b).width(),"fadeInRight"),U("#soul-columns"+b).css({top:U(this).offset().top,left:i}).removeClass().addClass(e+" animated")}),U("#main-list"+b+" .soul-dropList").on("mouseover",function(e){if(U("#soul-dropList"+b).is(":visible")&&!U("#soul-dropList"+b).hasClass("fadeOutLeft"))return!1;v.hideColumns(m),v.hideCondition(m),e.stopPropagation(),B&&clearTimeout(B),U("#soul-dropList"+b+">.filter-search>input").val(""),U("#soul-dropList"+b).show();var i,t=U("#main-list"+b).data("field"),l=U("#main-list"+b).offset().left+U("#soul-dropList"+b).width()+U("#soul-dropList"+b).width()<document.body.clientWidth?(i=U("#main-list"+b).offset().left+U("#main-list"+b).width(),"fadeInLeft"):(i=U("#main-list"+b).offset().left-U("#soul-dropList"+b).width(),"fadeInRight");U("#soulDropList"+b).find("."+t+"DropList li input[type=checkbox]:checked").prop("checked",!1);var e=X[m.id]||{},a=JSON.parse(e.filterSos||null),o="",d="";if(a)for(x=0;x<a.length;x++)if(a[x].head&&"in"===a[x].mode&&a[x].field===t){for(o=a[x].id,d=a[x].prefix,D=0;D<a[x].values.length;D++)U("#soulDropList"+b).find("."+t+'DropList li input[type=checkbox][value="'+a[x].values[D]+'"]').prop("checked",!0);break}U("#soul-dropList"+b+">ul").data({head:!0,id:o,prefix:d,refresh:!0,split:U("#main-list"+b).data("split")}).html(U("#soulDropList"+b).find("."+t+"DropList li").clone()),U("#soul-dropList"+b).css({top:U(this).offset().top,left:i}).show().removeClass().addClass(l+" animated"),setTimeout(function(){U("#soul-dropList"+b+">.filter-search>input").focus(),j.render("checkbox","orm")},1);var n=!0;j.on("checkbox(soulDropList"+b+")",function(e){n=!1,v.updateDropList(m,t)}),U("#soul-dropList"+b+">ul>li[data-value]").on("click",function(){n&&U(this).find("div.layui-form-checkbox").trigger("click"),n=!0})}),U("#main-list"+b+" .soul-condition").on("mouseover",function(e){if(U("#soul-condition"+b).is(":visible")&&!U("#soul-condition"+b).hasClass("fadeOutLeft"))return!1;v.hideColumns(m),v.hideDropList(m),e.stopPropagation(),q&&clearTimeout(q);var i=document.body.clientWidth;U("#soul-condition"+b).show();var t,n,s=U(this).parent().data("field"),e=U(this).parent().offset().left+U(this).parent().width()+U("#soul-condition"+b).width()<i?(t=U(this).parent().offset().left+U(this).parent().width(),"fadeInLeft"):(t=U(this).parent().offset().left-U("#soul-condition"+b).width(),"fadeInRight"),l=[],i=X[m.id]||{},a=JSON.parse(i.filterSos||null);if(a)for(x=0;x<a.length;x++)if(a[x].head&&a[x].field===s&&("date"===a[x].mode||"group"===a[x].mode)){n=a[x];break}i=U(this).parent().data("type");if(v.startsWith(i,"date"))v.showDate(m,s,n,e,U(this).offset().top,U(this).parent().offset().left+U(this).parent().width(),"down",!0);else{var o={};for(x=0;x<g.length;x++)g[x].field&&(o[g[x].field]=g[x]);var d="<select lay-filter='conditionChange'>";for(r in _)d+='<option value="'+r+'">'+_[r]+"</option>";if(d+="</select>",l.push('<table class="condition-table"><tbody>'),n&&n.children&&0<n.children.length)for(x=0;x<n.children.length;x++){var r,u=n.children[x].id,c=n.children[x].prefix,h=n.children[x].type,p=n.children[x].value;for(r in l.push('<tr data-id="'+u+'">'),0===x?l.push('<td class="soul-condition-title">'+o[s].title+"</td>"):l.push('<td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" '+(c&&"and"!==c?"":"checked")+">    </div></td>"),l.push('<td style="width: 110px;"><div class="layui-block" ><select lay-filter="conditionChange">'),_)l.push('<option value="'+r+'" '+(r===h?"selected":"")+">"+_[r]+"</option>");l.push("</select></div></td>"),l.push('<td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" value="'+(p||"")+'" placeholder="值" /></div></td>'),l.push('<td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td>'),l.push("</tr>")}else l.push('<tr data-id="" data-type="eq" data-value=""><td class="soul-condition-title">'+o[s].title+'</td><td style="width: 110px;"><div class="layui-block" >'+d+'</div></td><td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" placeholder="值" /></div></td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td></tr>');function f(e){var i=e.data("id"),t=U("#soul-condition"+b).data("id"),l=e.find('input[lay-filter="soul-coondition-switch"]:checked').prop("checked")?"and":"or",a=e.find("select").val(),o=e.find(".value").val(),d=U("#soul-condition"+b).data("head");n=t?{id:i,prefix:l,mode:"condition",field:s,type:a,value:o,groupId:t}:{head:d,prefix:"and",mode:"group",field:s,children:[{id:v.getDifId(),prefix:l,mode:"condition",field:s,type:a,value:o,groupId:t}]},v.updateWhere(m,n),t?i||e.data("id",n.id):(U("#soul-condition"+b).data("id",n.id),e.data("id",n.children[0].id))}function y(e){var i;1===U(e).parents("table:eq(0)").find("tr").length?(i=U("#soul-condition"+b).data("id"),U("#soul-condition"+b).data("id",""),U(e).parents("tr:eq(0)").find("select").val("eq"),U(e).parents("tr:eq(0)").find(".value").val("").show(),j.render("select","orm")):(i=U(e).parents("tr:eq(0)").data("id"),0===U(e).parents("tr:eq(0)").index()&&U(e).parents("table:eq(0)").find("tr:eq(1)>td:eq(0)").html(o[s].title).addClass("soul-condition-title"),U(e).parents("tr:eq(0)").remove()),i&&v.updateWhere(m,{id:i,delete:!0})}l.push('</tbody></table><div style="text-align: center; padding-top: 5px"><button class="layui-btn layui-btn-sm" data-type="add"><i class="layui-icon">&#xe654;</i>添加</button><span style="display: inline-block;width: 50px"></span><button class="layui-btn layui-btn-sm" data-type="search"><i class="layui-icon">&#xe615;</i>查询</button></div>'),U("#soul-condition"+b).data({head:!0,id:n&&n.id||""}).html(l.join("")).css({top:U(this).offset().top,left:t}).show().removeClass().addClass(e+" animated"),U(".condition-table").on("click",function(){return!1}),U("#soul-condition"+b+" button[data-type]").on("click",function(){var e,i,t;return"add"===U(this).data("type")?(e=U("#soul-condition"+b).data("id"),t=U("#soul-condition"+b).data("head"),i=U("#soul-condition"+b).find("tr:eq(0)"),t=e?{head:t,prefix:"and",field:s,mode:"condition",type:"eq",value:"",groupId:e}:{head:t,prefix:"and",mode:"group",field:s,children:[{id:v.getDifId(),prefix:"and",field:s,mode:"condition",type:i.find("select").val(),value:i.find(".value").val()},{id:v.getDifId(),prefix:"and",field:s,mode:"condition",type:"eq",value:""}]},v.updateWhere(m,t),e||(U("#soul-condition"+b).data("id",t.id),i.data("id",t.children[0].id)),t='<tr data-id="'+(e?t:t.children[1]).id+'"><td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" checked>   </div></td><td style="width: 110px;"><div class="layui-block">'+d+'</div></td><td style="width: 110px;"><div class="layui-block"><input class="layui-input value" placeholder="值" /></div></td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td></tr>',U("#soul-condition"+b+">table>tbody").append(t),U("#soul-condition"+b).find(".del:last").on("click",function(){y(this)}),U("#soul-condition"+b+" input.value:last").on("input",function(){f(U(this).parents("tr:eq(0)"))})):"search"===U(this).data("type")&&v.soulReload(m),j.render("select","orm"),j.render("checkbox","orm"),!1}),U("#soul-condition"+b+" input.value").on("input",function(){f(U(this).parents("tr:eq(0)"))}),j.on("select(conditionChange)",function(e){"null"===e.value||"notNull"===e.value?U(this).parents("tr").find("input.value").hide():U(this).parents("tr").find("input.value").show(),f(U(e.elem).parents("tr:eq(0)"))}),j.on("switch(soul-coondition-switch)",function(e){f(U(this).parents("tr:eq(0)"))}),U("#soul-condition"+b+" .del").on("click",function(){y(this)})}j.render("select","orm"),j.render("checkbox","orm")}),U("#soul-columns"+b+", #soul-dropList"+b).on("mouseover",function(e){e.stopPropagation()}),U("#main-list"+b+" .soul-edit-condition").on("mouseover",function(e){v.hideColumns(m),v.hideDropList(m),v.hideCondition(m),e.stopPropagation()}).on("click",function(){U("#main-list"+b).hide(),v.showConditionBoard(m)}),U("#main-list"+b+" .soul-export").on("mouseover",function(e){v.hideColumns(m),v.hideDropList(m),v.hideCondition(m),e.stopPropagation()}).on("click",function(){U("#main-list"+b).hide(),v.export($[m.id])}),U("#main-list"+b+" .soul-clear-cache").on("mouseover",function(e){v.hideColumns(m),v.hideDropList(m),v.hideCondition(m),e.stopPropagation()}).on("click",function(){U("#main-list"+b).hide(),layui.soulTable&&layui.soulTable.clearCache(m),layer.msg("已还原！",{icon:1,time:1e3})}),U("#main-list"+b).on("mouseover",function(e){var i=e.pageX,t=e.pageY,l=U(this),a=l.offset().top,o=a+l.height(),e=l.offset().left,l=e+l.width();i<=e||l<=i||t<=a||o<=t||(v.hideColumns(m),v.hideDropList(m),v.hideCondition(m))})}else{for(c={},x=0;x<g.length;x++)"checkbox"!==g[x].type&&g[x].field&&g[x].filter&&g[x].filter.type&&(g[x].filter.field?c[g[x].filter.field]=g[x].filter.type:c[g[x].field]=g[x].filter.type);2!==JSON.stringify(c).length&&(m.where.tableFilterType=JSON.stringify(c))}if(0===U("#soulDropList"+b).length&&U("body").append('<div id="soulDropList'+b+'" style="display: none"></div>'),0<i.find(".soul-table-filter").length){var p=[],f=-1!==o.indexOf("data");if(i.find(".soul-table-filter").each(function(e,i){U(this).data("column")&&(f&&!U(this).data("items")||-1!==U(this).data("items").split(",").indexOf("data"))&&p.push(U(this).data("column"))}),0<p.length)if(void 0!==m.url&&m.page){var y=JSON.parse(JSON.stringify(m.where)),o=m.url;y.columns=JSON.stringify(p),U.ajax({url:o,data:y,dataType:"json",method:"post",headers:m.headers||{},contentType:m.contentType,success:function(e){var i,t=[];for(i in e){var l=e[i];if(1===l.length&&""===l[0]||0===l.length)t.push("<ul class='"+i+"DropList' data-value='"+i+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)</li></ul>");else{var a=[];a.push("<ul class='"+i+"DropList' data-value='"+i+"'>");var o,d=g;for(D=0;D<d.length;D++)if(d[D].field===i){if(d[D].filter.split){var n=[];for(x=0;x<l.length;x++)for(var s=l[x].split(d[D].filter.split),r=0;r<s.length;r++)-1===n.indexOf(s[r])&&n.push(s[r]);l=n}for(l.sort(function(e,i){return isNaN(e)||isNaN(i)?String(e)>=String(i):Number(e)-Number(i)}),x=0;x<l.length;x++)-1===G.indexOf(l[x])&&((o={})[i]=l[x],a.push('<li data-value="'+String(l[x]).toLowerCase()+'"><input type="checkbox" value="'+l[x]+'" title="'+v.parseTempData(d[D],l[x],o,!0).replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+b+'"></li>'));break}a.push("</ul>"),t.push(a.join(""))}}U("#soulDropList"+b).html(t.join(""))},error:function(){}})}else{var k=M[m.id],C={};for(x=0;x<k.length;x++)for(D=0;D<p.length;D++){var w=void 0===k[x][p[D]]?"":k[x][p[D]];C[p[D]]?-1===C[p[D]].indexOf(w)&&C[p[D]].push(w):C[p[D]]=[w]}for(var L=g,S=[],D=0;D<L.length;D++){var N=L[D].field,O=C[N];if(!O||1===O.length&&""===O[0])S.push("<ul class='"+N+"DropList' data-value='"+N+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)</li></ul>");else{if(L[D].filter&&L[D].filter.split){var T=[];for(x=0;x<O.length;x++)for(var I=String(O[x]).split(L[D].filter.split),F=0;F<I.length;F++)-1===T.indexOf(I[F])&&T.push(I[F]);O=T}O.sort(function(e,i){return isNaN(e)||isNaN(i)?String(e)>=String(i):Number(e)-Number(i)});var W,P=[];for(P.push("<ul class='"+N+"DropList' data-value='"+N+"'>"),x=0;x<O.length;x++)-1===G.indexOf(O[x])&&((W={})[N]=O[x],P.push('<li data-value="'+String(O[x]).toLowerCase()+'"><input type="checkbox" value="'+O[x]+'" title="'+v.parseTempData(L[D],O[x],W,!0).replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+b+'"></li>'));P.push("</ul>"),S.push(P.join(""))}}U("#soulDropList"+b).html(S.join(""))}else v.bindFilterClick(m)}this.bindFilterClick(m)}else m.url&&!m.page?M[m.id]=layui.table.cache[m.id]:M[m.id]=m.data||layui.table.cache[m.id]},showConditionBoard:function(f){for(var a,e,y=this,m=f.id,i=X[f.id]||{},o=i.tableFilterType?JSON.parse(i.tableFilterType):{},t=i.filterSos?JSON.parse(i.filterSos):[],d=[],n={},l=f.filter&&f.filter.items||K,s=y.getCompleteCols(f.cols),v=0;v<s.length;v++)s[v].field&&s[v].filter&&(a=a||s[v],e=s[v].filter.items||l,n[s[v].field]={title:s[v].title,items:e});for(d.push('<div class="soul-edit-out">'),d.push('<div class="layui-form" lay-filter="soul-edit-out">'),d.push('<div><a class="layui-btn layui-btn-sm" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-sm" data-type="addGroup"><i class="layui-icon layui-icon-add-circle" ></i> 添加分组</a><a class="layui-btn layui-btn-sm" data-type="search" style="float: right"><i class="layui-icon layui-icon-search"></i> 查询</a><span style="float: right"><input type="checkbox" lay-filter="out_auto" class="out_auto" title="实时更新"></span></div>'),d.push("<hr>"),d.push("<ul>"),v=0;v<t.length;v++)!function e(i,t,l,a,o){var d=i.id,n=i.field,s=i.mode,r=i.type,u="or"===i.prefix;t.push('<li data-id="'+d+'" data-field="'+n+'" '+(o?'class="last"':"")+' data-mode="'+s+'" data-type="'+r+'" data-value="'+(void 0===i.value?"":i.value)+'" >');t.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>');t.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" '+(u?"":"checked")+"></div>");switch(s){case"in":t.push('<div class="layui-firebrick item-field">'+l[n].title+"</div>"),t.push('<div class="layui-deeppink item-type" >筛选数据</div>'),t.push('<div class="layui-blueviolet item-value">共'+(i.values?i.values.length:0)+"条数据</div>"),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"date":t.push('<div class="layui-firebrick item-field">'+l[n].title+"</div>"),t.push('<div class="layui-deeppink item-type">选择日期</div>'),t.push('<div class="layui-blueviolet item-value">'+("specific"===i.type?i.value||"请选择":b[i.type])+"</div>"),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"condition":t.push('<div class="layui-firebrick item-field">'+l[n].title+"</div>"),t.push('<div class="layui-deeppink item-type">'+_[i.type]+"</div>"),"null"!==r&&"notNull"!==r&&t.push('<div class="layui-blueviolet item-value">'+(void 0===i.value||""===i.value?"请输入...":i.value)+"</div>"),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"group":if(t.push('<div class="layui-firebrick">分组</div>'),t.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"></i> 添加分组</a></div>'),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),t.push('<ul class="group '+(o?"":"line")+'">'),i.children)for(var c=0;c<i.children.length;c++)e(i.children[c],t,l,0===c,c===i.children.length-1);t.push("</ul>")}t.push("</li>")}(t[v],d,n,0,v===t.length-1);function r(e){y.hideDropList(f),y.hideCondition(f),y.hideColumns(f),y.hideBfPrefix(f),y.hideBfType(f);var i=U(e).offset().top+U(e).outerHeight(),t=U(e).offset().left;U("#soul-bf-column"+m).find("li.soul-bf-selected").removeClass("soul-bf-selected"),U("#soul-bf-column"+m).data("field",U(e).parent().data("field")).data("id",U(e).parent().data("id")).data("mode",U(e).parent().data("mode")).data("group",U(e).parents("li:eq(2)").data("id")||"").data("refresh",U(".soul-edit-out .out_auto").prop("checked")).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+U(e).parent().data("field")+'"]').addClass("soul-bf-selected")}function u(e){y.hideDropList(f),y.hideCondition(f),y.hideColumns(f),y.hideBfColumn(f),y.hideBfPrefix(f);var i=U(e).offset().top+U(e).outerHeight(),t=U(e).offset().left,l=U(e).parent().data("field");switch(U("#soul-bf-type"+m+" li").hide(),o[l]&&0===o[l].indexOf("date")&&U("#soul-bf-type"+m+" li[data-mode=date]").show(),-1!==n[l].items.indexOf("data")&&U("#soul-bf-type"+m+" li[data-mode=in]").show(),-1!==n[l].items.indexOf("condition")&&U("#soul-bf-type"+m+" li[data-mode=condition]").show(),U("#soul-bf-type"+m).find("li.soul-bf-selected").removeClass("soul-bf-selected"),U(e).parent().data("mode")){case"in":U("#soul-bf-type"+m).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":U("#soul-bf-type"+m).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":U("#soul-bf-type"+m).find('li[data-value="'+U(e).parent().data("type")+'"]').addClass("soul-bf-selected")}U("#soul-bf-type"+m).data("type",U(e).parent().data("type")).data("mode",U(e).parent().data("mode")).data("id",U(e).parent().data("id")).data("group",U(e).parents("li:eq(2)").data("id")||"").data("refresh",U(".soul-edit-out .out_auto").prop("checked")).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated")}function c(i){y.hideColumns(f),y.hideBfType(f),y.hideBfPrefix(f),y.hideBfColumn(f);var e=U(i).offset().left,t=U(i).parent().data("mode"),l=U(i).parent().data("field"),a=U(i).parent().data("id"),o=U(i).parent().data("head"),d=U(i).parent().data("prefix"),n=U(i).parent().data("value"),s=U(".soul-edit-out .out_auto").prop("checked"),r=X[f.id]||{},u=r.filterSos?JSON.parse(r.filterSos):[];switch(t){case"in":if(y.hideCondition(f),B&&clearTimeout(B),U("#soul-dropList"+m+">.filter-search>input").val(""),U("#soul-dropList"+m).show(),U("#soulDropList"+m).find("."+l+"DropList li input[type=checkbox]:checked").prop("checked",!1),(h=y.getFilterSoById(u,a)).values)for(v=0;v<h.values.length;v++)U("#soulDropList"+m).find("."+l+'DropList li input[type=checkbox][value="'+h.values[v]+'"]').prop("checked",!0);U("#soul-dropList"+m+">ul").data("id",a).data("head",o).data("refresh",s).data("prefix",d).html(U("#soulDropList"+m).find("."+l+"DropList li").clone()),j.render("checkbox","orm"),p=U(i).offset().top+U(i).outerHeight(),U("#soul-dropList"+m).css({top:p,left:e}).show().removeClass().addClass("fadeInUp animated"),setTimeout(function(){U("#soul-dropList"+m+">.filter-search>input").focus()},1);var c=!0;j.on("checkbox(soulDropList"+m+")",function(e){c=!1,y.updateDropList(f,l)}),U("#soul-dropList"+m+">ul>li[data-value]").on("click",function(){c&&U(this).find("div.layui-form-checkbox").trigger("click"),c=!0});break;case"date":y.hideDropList(f),q&&clearTimeout(q);var h=y.getFilterSoById(u,a),p=U(i).offset().top+U(i).height();y.showDate(f,l,h,"fadeInUp",p,e,"down",s);break;case"condition":U(i).hide(),U(i).after('<div><input class="layui-input tempValue" value="" /></div>'),U(i).next().children().val(n).select().on("keydown",function(e){13===e.keyCode&&U(this).blur()}).on("blur",function(){var e=U(this).val();U(i).html(void 0===e||""===e?"请输入...":e),U(i).show(),U(this).parent().remove(),e!==n&&(U(i).parent().data("value",e),y.updateWhere(f,{id:a,value:e}),s&&y.soulReload(f))})}}d.push("</ul>"),d.push("</div>"),d.push("</div>"),layer.open({title:"编辑条件",type:1,offset:"auto",area:["480px","480px"],content:d.join("")}),j.render(null,"soul-edit-out"),j.on("checkbox(out_auto)",function(e){e.elem.checked&&y.soulReload(f)}),j.on("switch(soul-edit-switch)",function(e){var i,t,l;t=(i=e).elem.checked?"and":"or",l=U(i.elem).parents("li:eq(0)").data("id"),e=U(".soul-edit-out .out_auto").prop("checked"),U(i.elem).parents("li:eq(0)").data("prefix",t),y.updateWhere(f,{id:l,prefix:t}),e&&y.soulReload(f)}),U(".soul-edit-out .item-field").on("click",function(e){e.stopPropagation(),r(this)}),U(".soul-edit-out .item-type").on("click",function(e){e.stopPropagation(),u(this)}),U(".soul-edit-out .item-value").on("click",function(e){e.stopPropagation(),c(this)}),U(".soul-edit-out .delete-item").on("click",function(){var e=U(this).parent().data("id"),i=U(".soul-edit-out .out_auto").prop("checked");U(this).parent().remove(),y.updateWhere(f,{id:e,delete:!0}),i&&y.soulReload(f)}),U(".soul-edit-out a[data-type]").on("click",function(){"search"===U(this).data("type")?y.soulReload(f):function e(i){var t=U(".soul-edit-out .out_auto").prop("checked");d=[];switch(U(i).data("type")){case"addOne":var l={prefix:"and",field:a.field,mode:"condition",type:"eq",value:""};U(i).parent().parent().data("id")&&U.extend(l,{groupId:U(i).parent().parent().data("id")}),y.updateWhere(f,l),d.push('<li data-id="'+l.id+'" data-field="'+l.field+'" data-mode="'+l.mode+'" data-type="'+l.type+'" data-value="'+l.value+'" data-prefix="'+l.prefix+'" class="last">'),d.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),d.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked></div>'),d.push('<div class="layui-firebrick item-field">'+n[l.field].title+"</div>"),d.push('<div class="layui-deeppink item-type">等于</div>'),d.push('<div class="layui-blueviolet item-value">请输入...</div>'),d.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),d.push("</li>");break;case"addGroup":l={prefix:"and",mode:"group",children:[]};U(i).parent().parent().data("id")&&U.extend(l,{groupId:U(i).parent().parent().data("id")}),y.updateWhere(f,l),d.push('<li data-id="'+l.id+'" class="last">'),d.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),d.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked></div>'),d.push('<div class="layui-firebrick">分组</div>'),d.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"></i> 添加分组</a></div>'),d.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),d.push('<ul class="group">'),d.push("</ul>"),d.push("</li>")}t&&y.soulReload(f);0<U(i).parent().parent().children("ul").children("li").length&&(U(i).parent().parent().children("ul").children("li:last").removeClass("last"),0<U(i).parent().parent().children("ul").children("li:last").children("ul.group").length&&U(i).parent().parent().children("ul").children("li:last").children("ul.group").addClass("line"));U(i).parent().parent().children("ul").append(d.join(""));j.render("checkbox","soul-edit-out");"addGroup"===U(i).data("type")?U(i).parent().parent().children("ul").children("li:last").find("a[data-type]").on("click",function(){e(this)}):(U(i).parent().parent().children("ul").children("li:last").find(".item-field").on("click",function(e){e.stopPropagation(),r(this)}),U(i).parent().parent().children("ul").children("li:last").find(".item-type").on("click",function(e){e.stopPropagation(),u(this)}),U(i).parent().parent().children("ul").children("li:last").find(".item-value").on("click",function(e){e.stopPropagation(),c(this)}));U(i).parent().parent().children("ul").children("li:last").children(".delete-item").on("click",function(){var e=U(this).parent().data("id"),i=U(".soul-edit-out .out_auto").prop("checked");U(this).parent().remove(),y.updateWhere(f,{id:e,delete:!0}),i&&y.soulReload(f)})}(this)})},hideColumns:function(e,i){var t=e.id;U("#soul-columns"+t).removeClass().addClass("fadeOutLeft animated"),R&&clearTimeout(R),void 0===i||i?R=setTimeout(function(e){U("#soul-columns"+t).hide()},500):U("[id^=soul-columns]").hide()},hideDropList:function(e,i){var t=e.id;U("#soul-dropList"+t).removeClass().addClass("fadeOutLeft animated"),B&&clearTimeout(B),void 0===i||i?B=setTimeout(function(e){U("#soul-dropList"+t).hide()},500):U("[id^=soul-dropList]").hide()},hideCondition:function(e,i){var t=e.id;U("#soul-condition"+t).removeClass().addClass("fadeOutLeft animated"),q&&clearTimeout(q),void 0===i||i?q=setTimeout(function(e){U("#soul-condition"+t).hide()},500):U("[id^=soul-condition]").hide()},hideBfPrefix:function(e,i){var t=e.id;U("#soul-bf-prefix"+t).removeClass().addClass("fadeOutDown animated"),l&&clearTimeout(l),void 0===i||i?l=setTimeout(function(){U("#soul-bf-prefix"+t).hide()},500):U("[id=soul-bf-prefix"+t+"]").hide()},hideBfColumn:function(e,i){var t=e.id;U("#soul-bf-column"+t).removeClass().addClass("fadeOutDown animated"),l&&clearTimeout(l),void 0===i||i?l=setTimeout(function(){U("#soul-bf-column"+t).hide()},500):U("[id=soul-bf-column"+t+"]").hide()},hideBfType:function(e,i){var t=e.id;U("#soul-bf-type"+t).removeClass().addClass("fadeOutDown animated"),a&&clearTimeout(a),void 0===i||i?a=setTimeout(function(){U("#soul-bf-type"+t).hide()},500):U("[id=soul-bf-type"+t+"]").hide()},bindFilterClick:function(o){var d,n=this,e=U(o.elem),i=e.next().children(".layui-table-box").children(".layui-table-header").children("table"),t=e.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),l=e.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),s=o.id,r=o.filter&&o.filter.items||K;function a(i){var e=i.data("items")?i.data("items").split(","):r;n.hideColumns(o,!1),n.hideDropList(o,!1),n.hideCondition(o,!1),U("[id^=main-list]").hide(),U("#main-list"+s).data({field:i.data("column"),split:i.data("split")}),U("#soul-columns"+s+" [type=checkbox]").attr("disabled",!1),U("#soul-columns"+s+" li[data-key="+i.parents("th").data("key").split("-")[2]+"] [type=checkbox]").attr("disabled",!0),U("#main-list"+s+" > li").hide(),i.hasClass("layui-table-sort")&&U("#main-list"+s+" .soul-sort").show();for(var t,l,a=0;a<e.length;a++)U("#main-list"+s+" ."+p[e[a]]).show(),U("#main-list"+s+" ."+p[e[a]]).index()!==a+2&&U("#main-list"+s+'>li:eq("'+(a+2)+'")').before(U("#main-list"+s+" ."+p[e[a]]));d&&clearTimeout(d),l=i.offset().left+U("#main-list"+s).outerWidth()<document.body.clientWidth?(t=i.offset().left+10,"fadeInLeft"):(t=i.offset().left-U("#main-list"+s).outerWidth(),"fadeInRight"),U("#main-list"+s).data("type",o.where.tableFilterType&&JSON.parse(o.where.tableFilterType)[i.data("column")]||"").hide().css({top:i.offset().top+10,left:t}).show().removeClass().addClass(l+" animated"),U("#main-list"+s+" .soul-sort").on("click",function(e){i.siblings(".layui-table-sort").find(".layui-table-sort-"+U(this).data("value")).trigger("click"),U("#main-list"+s).hide()}),j.render("checkbox","orm")}i.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),a(U(this))}),t.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),a(U(this))}),l.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),a(U(this))}),U(document).on("click",function(e){U("#main-list"+s).hide(),n.hideColumns(o,!1),n.hideDropList(o,!1),n.hideCondition(o,!1),n.hideBfPrefix(o,!1),n.hideBfColumn(o,!1),n.hideBfType(o,!1)}),U("#main-list"+s+",#soul-columns"+s+",#soul-dropList"+s+",#soul-condition"+s).on("click",function(e){U(this).find(".layui-form-selected").removeClass("layui-form-selected"),e.stopPropagation()}),n.renderBottomCondition(o);for(var e=X[o.id]||{},u=JSON.parse(e.filterSos||"[]"),c=0;c<u.length;c++)if(u[c].head){var h=!1;switch(u[c].mode){case"in":u[c].values&&0<u[c].values.length&&(h=!0);break;case"date":"all"!==u[c].type&&void 0!==u[c].value&&""!==u[c].value&&(h=!0);break;case"group":u[c].children&&0<u[c].children.length&&(h=!0)}i.find('thead>tr>th[data-field="'+u[c].field+'"] .soul-table-filter').attr("soul-filter",""+h),t.find('thead>tr>th[data-field="'+u[c].field+'"] .soul-table-filter').attr("soul-filter",""+h),l.find('thead>tr>th[data-field="'+u[c].field+'"] .soul-table-filter').attr("soul-filter",""+h)}},resize:function(e){var i,t=U(e.elem),l=t.next().children(".layui-table-box"),a=l.children(".layui-table-main");0<t.next().children(".soul-bottom-contion").length&&(t.next().children(".soul-bottom-contion").children(".condition-items").css("width",t.next().children(".soul-bottom-contion").width()-t.next().children(".soul-bottom-contion").children(".editCondtion").outerWidth()),i=t.next().height()-t.next().children(".soul-bottom-contion").outerHeight(),0<t.next().children(".layui-table-tool").length&&(i-=t.next().children(".layui-table-tool").outerHeight()),0<t.next().children(".layui-table-total").length&&(i-=t.next().children(".layui-table-total").outerHeight()),0<t.next().children(".layui-table-page").length&&(i-=t.next().children(".layui-table-page").outerHeight()),i-=t.next().children(".layui-table-box").children(".layui-table-header").outerHeight(),t.next().children(".layui-table-box").children(".layui-table-body").height(i),e=i-this.getScrollWidth(a[0]),i=a.children("table").height(),t.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").height(e<=i?e:"auto"),a=a.width()-a.prop("clientWidth"),l.children(".layui-table-fixed-r").css("right",a-1))},updateDropList:function(e,i){U(e.elem);var t=e.id,l=U("#soul-dropList"+t+">ul").data("id"),a=U("#soul-dropList"+t+">ul input[type=checkbox]:checked"),o=[],d=U("#soul-dropList"+t+">ul").data("head"),n=U("#soul-dropList"+t+">ul").data("prefix"),s=U("#soul-dropList"+t+">ul").data("refresh"),r=U("#soul-dropList"+t+">ul").data("split");0<a.length&&a.each(function(){o.push(U(this).val())});r={id:l,head:d,prefix:n||"and",mode:"in",field:i,split:r,values:o};this.updateWhere(e,r),l||U("#soul-dropList"+t+">ul").data("id",r.id),0<U(".soul-edit-out").length&&U('.soul-edit-out li[data-id="'+r.id+'"]>.item-value').html("共"+(r.values?r.values.length:0)+"条数据"),s&&this.soulReload(e)},getFilterSoById:function(e,i){for(var t=0;t<e.length;t++){if(e[t].id===i)return e[t];if("group"===e[t].mode)for(var l=0;l<e[t].children.length;l++){var a=this.getFilterSoById(e[t].children,i);if(a)return a}}return null},updateWhere:function(e,i){var o=this,t=X[e.id]||{},l=JSON.parse(t.filterSos||"[]");if(i.id||i.groupId)for(var a=0;a<l.length;a++){if(i.delete&&l[a].id===i.id){l.splice(a,1);break}if(function e(i,t){var l=!1;i.id===t.id&&(U.extend(i,t),l=!0);if(t.id||i.id!==t.groupId){if("group"===i.mode)for(var a=0;a<i.children.length;a++){if(t.delete&&i.children[a].id===t.id)return i.children.splice(a,1),!0;if(e(i.children[a],t))return!0}}else i.children.push(U.extend(t,{id:o.getDifId()}));return l}(l[a],i))break}else("in"!==i.mode||i.values&&0<i.values.length)&&l.push(U.extend(i,{id:o.getDifId()}));t.filterSos=JSON.stringify(l),e.where=t,X[e.id]=t},soulReload:function(e,i){var a,o,d,t,n=this,l=U(e.elem),s=l.next().children(".layui-table-box").children(".layui-table-main").scrollLeft();A[e.id]=void 0===i||i,void 0!==e.url&&e.page?(l.data("scrollLeft",s),z.reload(e.id,{where:X[e.id]||{},page:{curr:1}})):(t=X[e.id]||{},a=JSON.parse(t.filterSos||"[]"),o=t.tableFilterType?JSON.parse(t.tableFilterType):{},i=layer.load(2),e.page||(e.limit=1e8),0<a.length?(d=[],layui.each(M[e.id],function(e,i){for(var t=!0,l=0;l<a.length;l++)t=n.handleFilterSo(a[l],i,o,t,0===l);t&&d.push(i)}),e.page?z.reload(e.id,{data:d,initSort:e.initSort,isSoulFrontFilter:!0,page:{curr:1}}):(t=e.url,l.next().off("click"),z.reload(e.id,{url:"",initSort:e.initSort,isSoulFrontFilter:!0,data:d}).config.url=t),e.data=d):(e.page?z.reload(e.id,{data:M[e.id],initSort:e.initSort,isSoulFrontFilter:!0,page:{curr:1}}):z.reload(e.id,{data:M[e.id],initSort:e.initSort,isSoulFrontFilter:!0}),e.data=M[e.id]),l.next().children(".layui-table-box").children(".layui-table-main").scrollLeft(s),layer.close(i))},handleFilterSo:function(e,i,t,l,a){var o,d,a=!a&&"or"===e.prefix,n=e.field,s=e.value,r=!0;if(e.children&&0<e.children.length){for(var u=0;u<e.children.length;u++)r=this.handleFilterSo(e.children[u],i,t,r,0===u);return a?l||r:l&&r}switch(e.mode){case"in":if(!(e.values&&0<e.values.length))return l;if(e.split){for(var c=(i[n]+"").split(e.split),h=!1,u=0;u<c.length;u++)-1!==e.values.indexOf(c[u])&&(h=!0);r=h}else r=-1!==e.values.indexOf(i[n]+"");break;case"condition":if("null"!==e.type&&"notNull"!==e.type&&(void 0===s||""===s))return l;switch(e.type){case"eq":r=isNaN(i[n])||isNaN(s)?i[n]===s:Number(i[n])===Number(s);break;case"ne":r=isNaN(i[n])||isNaN(s)?i[n]!==s:Number(i[n])!==Number(s);break;case"gt":r=isNaN(i[n])||isNaN(s)?i[n]>s:Number(i[n])>Number(s);break;case"ge":r=isNaN(i[n])||isNaN(s)?i[n]>=s:Number(i[n])>=Number(s);break;case"lt":r=isNaN(i[n])||isNaN(s)?i[n]<s:Number(i[n])<Number(s);break;case"le":r=isNaN(i[n])||isNaN(s)?i[n]<=s:Number(i[n])<=Number(s);break;case"contain":r=-1!==(i[n]+"").indexOf(s);break;case"notContain":r=-1===(i[n]+"").indexOf(s);break;case"start":r=0===(i[n]+"").indexOf(s);break;case"end":var p=(i[n]+"").length-(s+"").length,r=0<=p&&(i[n]+"").lastIndexOf(s)===p;break;case"null":r=void 0===i[n]||""===i[n]||null===i[n];break;case"notNull":r=void 0!==i[n]&&""!==i[n]&&null!==i[n]}break;case"date":var f=new Date(Date.parse(i[n].replace(/-/g,"/")));switch(e.type){case"all":r=!0;break;case"yesterday":r=i[n]&&b(f,m()-86400,m()-1);break;case"thisWeek":r=i[n]&&b(f,v(),v()+604800-1);break;case"lastWeek":r=i[n]&&b(f,v()-604800,v()-1);break;case"thisMonth":r=i[n]&&b(f,new Date((new Date).setDate(1)).setHours(0,0,0,0)/1e3,(o=new Date,d=o.getMonth(),d=++d,new Date(o.getFullYear(),d,1)/1e3-1));break;case"thisYear":r=i[n]&&b(f,new Date((new Date).getFullYear(),1,1)/1e3,new Date((new Date).getFullYear()+1,1,1)/1e3-1);break;case"specific":var y=f.getFullYear();y+="-"+g(f.getMonth()+1),y+="-"+g(f.getDate()),r=i[n]&&y===s}}function m(){return(new Date).setHours(0,0,0,0)/1e3}function v(){var e=new Date,i=e.getDay()||7;return new Date(e.setDate(e.getDate()-i+1)).setHours(0,0,0,0)/1e3}function b(e,i,t){return e.getTime()/1e3>=i&&e.getTime()/1e3<=t}function g(e){return e=(e+="").length<=1?"0"+e:e}return a?l||r:l&&r},getDifId:function(){return i++},showDate:function(l,a,e,i,t,o,d,n){var s,r=this,u=l.id,c=[],h=document.body.clientWidth;for(s in c.push('<div class="'+a+'Condition" data-value="'+a+'" style="padding: 5px;" >'),c.push('<div class="layui-row">'),b)c.push('<div class="layui-col-sm4"><input type="radio" name="datetime'+u+a+'" lay-filter="datetime'+u+'" value="'+s+'" title="'+b[s]+'"></div>');c.push("</div>"),c.push('<div><input type="radio" name="datetime'+u+a+'" lay-filter="datetime'+u+'"  value="specific" title="过滤具体日期"> <input type="hidden" class="specific_value"><div class="staticDate"></div></div></div>'),U("#soul-condition"+u).html(c.join(""));var p=y.toDateString(new Date,"yyyy-MM-dd");e?(U("#soul-condition"+u).data({id:e.id,head:!0}),U("#soul-condition"+u+">."+a+'Condition [name^=datetime][value="'+e.type+'"]').prop("checked",!0),"specific"===e.type&&(p=e.value)):(U("#soul-condition"+u).data({id:"",head:!0}),U("#soul-condition"+u+">."+a+'Condition [name^=datetime][value="all"]').prop("checked",!0)),U("#soul-condition"+u+" .specific_value").val(p),f.render({elem:"#soul-condition"+u+" .staticDate",position:"static",calendar:!0,btns:["now"],value:p,done:function(e){var i=U("#soul-condition"+u).data("id"),t=U("#soul-condition"+u).data("head");U("#soul-condition"+u+" .specific_value").val(e),U("#soul-condition"+u+" [name^=datetime]:checked").prop("checked",!1),U("#soul-condition"+u+" [name^=datetime][value=specific]").prop("checked",!0);e={id:i,head:t,prefix:"and",mode:"date",field:a,type:"specific",value:e};r.updateWhere(l,e),i||U("#soul-condition"+u).data("id",e.id),0<U(".soul-edit-out").length&&U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html(e.value),n&&r.soulReload(l),j.render("radio","orm")}}),j.on("radio(datetime"+u+")",function(e){var i=U("#soul-condition"+u).data("id"),t=U("#soul-condition"+u).data("head"),e={id:i,head:t,prefix:"and",mode:"date",field:a,type:e.value,value:U("#soul-condition"+u+" .specific_value").val()};r.updateWhere(l,e),i||U("#soul-condition"+u).data("id",e.id),0<U(".soul-edit-out").length&&U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html(b[e.type]||e.value),n&&r.soulReload(l)}),j.render("radio","orm"),"down"===d?i=o+U("#soul-condition"+u).width()<h?"fadeInLeft":(o=o-U("#main-list"+u).width()-U("#soul-condition"+u).width(),"fadeInRight"):t=t-U("#soul-condition"+u).outerHeight()-10,U("#soul-condition"+u).css({top:t,left:o}).show().removeClass().addClass(i+" animated")},bottomConditionHtml:function(e,i,t,l){var a="or"===i.prefix,o=i.field;if("group"!==i.mode){switch(e.push('<div class="condition-item" data-field="'+o+'" data-id="'+i.id+'" data-mode="'+i.mode+'" data-type="'+i.type+'" data-value="'+(void 0===i.value?"":i.value)+'" data-prefix="'+(i.prefix||"and")+'">'),l||e.push('<div class="item-prefix layui-red">'+(a?"或":"与")+"</div> "),e.push('<div class="item-field layui-firebrick">'+t[o].title+"</div> "),e.push('<div class="item-type layui-deeppink">'),i.mode){case"in":e.push("筛选数据");break;case"condition":e.push(_[i.type]);break;case"date":e.push("选择日期");break;default:e.push("未知")}if(e.push("</div> "),"null"!==i.type&&"notNull"!==i.type){switch(e.push('<div class="item-value layui-blueviolet '+("date"===i.mode&&"specific"!==i.type)+'">'),i.mode){case"in":e.push("共"+(i.values?i.values.length:0)+"条数据");break;case"date":e.push("specific"===i.type?i.value||"请选择":b[i.type]);break;default:e.push(void 0===i.value||""===i.value?"请输入...":i.value)}e.push("</div>")}e.push('<i class="condition-item-close soul-icon soul-icon-unfold" ></i>'),e.push("</div>")}else if(i.children&&0<i.children.length){e.push('<div class="condition-item" data-id="'+i.id+'" data-prefix="'+(i.prefix||"and")+'">'),l||e.push('<div class="item-prefix layui-red">'+(a?"或":"与")+"</div> ");for(var d=0;d<i.children.length;d++)this.bottomConditionHtml(e,i.children[d],t,0===d);e.push('<i class="condition-item-close soul-icon soul-icon-unfold" ></i>'),e.push("</div>")}},renderBottomCondition:function(h){for(var e,p=this,i=X[h.id]||{},f=i.filterSos?JSON.parse(i.filterSos):[],o=i.tableFilterType?JSON.parse(i.tableFilterType):{},i=U(h.elem),y=h.id,i=i.next().children(".soul-bottom-contion"),d={},t=[],l=h.filter&&h.filter.items||K,a=p.getCompleteCols(h.cols),n=0;n<a.length;n++)a[n].field&&a[n].filter&&(-1===(e=a[n].filter.items||l).indexOf("data")&&-1===e.indexOf("condition")||(d[a[n].field]={title:a[n].title,items:e}));for(n=0;n<f.length;n++)p.bottomConditionHtml(t,f[n],d,0===n);if(i.children(".condition-items").html(t.join("")),t=[],0===U("#soul-bf-prefix"+y).length&&(t.push('<div id="soul-bf-prefix'+y+'" style="display: none;"><ul>'),t.push('<li data-value="and">与</li>'),t.push('<li data-value="or">或</li>'),t.push("</ul></div>")),0===U("#soul-bf-column"+y).length){for(var s in t.push('<div id="soul-bf-column'+y+'" style="display: none;"><ul>'),d)t.push('<li data-field="'+s+'">'+d[s].title+"</li>");t.push("</ul></div>")}if(0===U("#soul-bf-type"+y).length){for(var r in t.push('<div id="soul-bf-type'+y+'" style="display: none;"><ul>'),t.push('<li data-value="in" data-mode="in">筛选数据</li>'),t.push('<li data-value="all" data-mode="date">选择日期</li>'),_)t.push('<li data-value="'+r+'" data-mode="condition">'+_[r]+"</li>");t.push("</ul></div>")}0===U("#soul-bf-cond2-dropList"+y).length&&t.push('<div id="soul-bf-cond2-dropList'+y+'" style="display: none;"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"></div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;</i> 全选</div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;</i> 清空</div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;</i>反选</div></div><ul></ul></div>'),U("body").append(t.join("")),i.find(".item-prefix").off("click").on("click",function(e){e.stopPropagation(),U("#main-list"+y).hide(),p.hideDropList(h),p.hideCondition(h),p.hideColumns(h),p.hideBfColumn(h),p.hideBfType(h);var i=U(this).offset().top-U("#soul-bf-prefix"+y).outerHeight()-10,e=U(this).offset().left;U("#soul-bf-prefix"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),U("#soul-bf-prefix"+y).data("id",U(this).parent().data("id")).data("prefix",U(this).parent().data("prefix")).data("refresh",!0).show().css({top:i,left:e}).removeClass().addClass("fadeInUp animated").find('li[data-value="'+U(this).parent().data("prefix")+'"]').addClass("soul-bf-selected")}),i.find(".item-field").off("click").on("click",function(e){e.stopPropagation(),U("#main-list"+y).hide(),p.hideDropList(h),p.hideCondition(h),p.hideColumns(h),p.hideBfPrefix(h),p.hideBfType(h);var i=U(this).offset().top-U("#soul-bf-column"+y).outerHeight()-10,e=U(this).offset().left;U("#soul-bf-column"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),U("#soul-bf-column"+y).data("field",U(this).parent().data("field")).data("id",U(this).parent().data("id")).data("mode",U(this).parent().data("mode")).data("group",U(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:i,left:e}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+U(this).parent().data("field")+'"]').addClass("soul-bf-selected")}),i.find(".item-type").on("click",function(e){e.stopPropagation(),U("#main-list"+y).hide(),p.hideDropList(h),p.hideCondition(h),p.hideColumns(h),p.hideBfColumn(h),p.hideBfPrefix(h);var i=U(this).parent().data("field");U("#soul-bf-type"+y+" li").hide(),o[i]&&0===o[i].indexOf("date")&&U("#soul-bf-type"+y+" li[data-mode=date]").show(),-1!==d[i].items.indexOf("data")&&U("#soul-bf-type"+y+" li[data-mode=in]").show(),-1!==d[i].items.indexOf("condition")&&U("#soul-bf-type"+y+" li[data-mode=condition]").show();e=U(this).offset().top-U("#soul-bf-type"+y).outerHeight()-10,i=U(this).offset().left;switch(U("#soul-bf-type"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),U(this).parent().data("mode")){case"in":U("#soul-bf-type"+y).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":U("#soul-bf-type"+y).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":U("#soul-bf-type"+y).find('li[data-value="'+U(this).parent().data("type")+'"]').addClass("soul-bf-selected")}U("#soul-bf-type"+y).data("type",U(this).parent().data("type")).data("mode",U(this).parent().data("mode")).data("id",U(this).parent().data("id")).data("group",U(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:e,left:i}).removeClass().addClass("fadeInUp animated")}),i.find(".item-value").on("click",function(e){e.stopPropagation(),U("#main-list"+y).hide(),p.hideColumns(h),p.hideBfType(h),p.hideBfPrefix(h),p.hideBfColumn(h);var i=U(this).offset().left,e=U(this).parent().data("mode"),t=U(this).parent().data("field"),l=U(this).parent().data("id"),a=U(this).parent().data("head"),o=U(this).parent().data("prefix");switch(e){case"in":p.hideCondition(h),B&&clearTimeout(B),U("#soul-dropList"+y+">.filter-search>input").val(""),U("#soul-dropList"+y).show(),U("#soulDropList"+y).find("."+t+"DropList li input[type=checkbox]:checked").prop("checked",!1);for(var d=p.getFilterSoById(f,l),n=0;n<d.values.length;n++)U("#soulDropList"+y).find("."+t+'DropList li input[type=checkbox][value="'+d.values[n]+'"]').prop("checked",!0);U("#soul-dropList"+y+">ul").data("id",l).data("head",a).data("refresh",!0).data("prefix",o).html(U("#soulDropList"+y).find("."+t+"DropList li").clone()),j.render("checkbox","orm"),r=U(this).offset().top-U("#soul-dropList"+y).outerHeight()-10,U("#soul-dropList"+y).css({top:r,left:i}).show().removeClass().addClass("fadeInUp animated"),setTimeout(function(){U("#soul-dropList"+y+">.filter-search>input").focus()},1);var s=!0;j.on("checkbox(soulDropList"+y+")",function(e){s=!1,p.updateDropList(h,t)}),U("#soul-dropList"+y+">ul>li[data-value]").on("click",function(){s&&U(this).find("div.layui-form-checkbox").trigger("click"),s=!0});break;case"date":p.hideDropList(h),q&&clearTimeout(q);var d=p.getFilterSoById(f,l),r=U(this).offset().top-10;p.showDate(h,t,d,"fadeInUp",r,i,"up",!0);break;default:p.hideDropList(h),q&&clearTimeout(q);var u=this,c=U(this).parents(".condition-item:eq(0)").data("value");U(u).hide(),U(u).after('<div><input style="height: 25px;" class="layui-input tempValue" value="" /></div>'),U(u).next().children().val(c).select().on("keydown",function(e){13===e.keyCode&&U(this).blur()}).on("blur",function(){var e=U(this).val();U(u).html(void 0===e||""===e?"请输入...":e),U(u).show(),U(this).parent().remove(),e!==c&&(p.updateWhere(h,{id:l,value:e}),p.soulReload(h))})}}),U("#soul-bf-prefix"+y+">ul>li").off("click").on("click",function(){var e=U(this).parent().parent().data("id"),i=U(this).data("value"),t=U(this).parent().parent().data("prefix"),l=U(this).parent().parent().data("refresh");t!==i&&(p.updateWhere(h,{id:e,prefix:i}),!0===l&&p.soulReload(h))}),U("#soul-bf-column"+y+">ul>li").off("click").on("click",function(){var e=U(this).parent().parent().data("field"),i=U(this).data("field"),t=U(this).parent().parent().data("mode"),l=U(this).parent().parent().data("group"),a=U(this).parent().parent().data("refresh");e!==i&&(e={id:U(this).parent().parent().data("id"),field:i},-1===d[i].items.indexOf(u[t])?U.extend(e,U.extend({},c[u[t]],"condition"===c[u[t]].mode&&p.startsWith(o[i],"date")?{mode:"date",type:"all"}:{})):"in"===t?U.extend(e,{values:[]}):"date"!==t||p.startsWith(o[i],"date")?"date"!==t&&p.startsWith(o[i],"date")&&U.extend(e,{mode:"date",type:"all"}):U.extend(e,{mode:"condition",type:"eq",value:""}),l&&p.updateWhere(h,{id:l,head:!1}),p.updateWhere(h,e),0<U(".soul-edit-out").length&&(U('.soul-edit-out li[data-id="'+e.id+'"]').data(e).children(".item-field").html(d[i].title),"in"===e.mode?(U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-type").html("筛选数据"),U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html("共0条数据")):t!==e.mode&&("date"===e.mode?(U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-type").html("选择日期"),U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html(b[e.type])):"condition"===e.mode&&(U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-type").html(_[e.type]),U('.soul-edit-out li[data-id="'+e.id+'"]').children(".item-value").html(""===e.value?"请输入...":e.value)))),!0===a&&p.soulReload(h))}),U("#soul-bf-type"+y+">ul>li").off("click").on("click",function(){var e=U(this).data("value")+"",i=U(this).data("mode"),t=U(this).parent().parent().data("type"),l=U(this).parent().parent().data("mode"),a=U(this).parent().parent().data("group"),o=U(this).parent().parent().data("refresh");if(t!==e){var d={id:U(this).parent().parent().data("id"),type:e,mode:i};if(l!==i&&U.extend(d,{value:"",values:[]}),a&&"in"===i&&p.updateWhere(h,{id:a,head:!1}),p.updateWhere(h,d),0<U(".soul-edit-out").length)switch(U('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").show(),U('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-type").html(_[e]||("in"===i?"筛选数据":"选择日期")),i){case"in":U('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html("共0条数据");break;case"date":U('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html(b[e]);break;case"condition":l!==i&&U('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html("请输入..."),U('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value")["null"==e||"notNull"==e?"hide":"show"]()}!0===o&&p.soulReload(h)}}),i.find(".condition-items .condition-item .condition-item-close").on("click",function(){p.updateWhere(h,{id:U(this).parents(".condition-item:eq(0)").data("id"),delete:!0}),p.soulReload(h)})},export:function(i,e){"string"==typeof i&&(i=$[i]);var t=layer.msg("文件下载中",{icon:16,time:-1,anim:-1,fixed:!1}),p=this.deepClone(i.cols),l=i.elem.next().find("style")[0],a=l.sheet||l.styleSheet||{},o=a.cssRules||a.rules;layui.each(o,function(e,i){var t;i.style.width&&(t=i.selectorText.split("-"),p[t[3]][t[4]].width=parseInt(i.style.width))});var f,d,n=JSON.parse(JSON.stringify(i.data||M[i.id])),s={},r={},u=[],c={},h=U(i.elem),y=h.next().children(".layui-table-box").children(".layui-table-body").children("table"),m=i.totalRow?h.next().children(".layui-table-total").children(":first"):null,v=Object.assign({},i.excel,e),b=v.filename?"function"==typeof v.filename?v.filename.call(this):v.filename:"表格数据.xlsx",l=!0===v.checked,a=!0===v.curPage,g=v.columns,o=v.totalRow,e=b.substring(b.lastIndexOf(".")+1,b.length),x=v.add&&v.add.top&&Array.isArray(v.add.top.data)?v.add.top.data.length+1:1,k=v.add&&v.add.bottom&&Array.isArray(v.add.bottom.data)?v.add.bottom.data.length:0;if(v.data){if(!Array.isArray(v.data))return console.error("导出指定数据 data 不符合数组格式",v.data),void layer.close(t);n=v.data}else if(l){if(n=[],M[i.id]&&0<M[i.id].length)for(T=0;T<M[i.id].length;T++)M[i.id][T][z.config.checkName]&&n.push(M[i.id][T])}else if(a)n=layui.table.cache[i.id];else if(i.url&&i.page){var C=!0,a=V[i.id]?X[i.id]:$[i.id].where;if(i.contentType&&0==i.contentType.indexOf("application/json")&&(a=JSON.stringify(a)),U.ajax({url:i.url,data:a,dataType:"json",method:i.method||"post",async:!1,cache:!1,headers:i.headers||{},contentType:i.contentType,success:function(e){(e="function"==typeof i.parseData?i.parseData(e)||e:e)[i.response.statusName]!=i.response.statusCode?layer.msg('返回的数据不符合规范，正确的成功状态码应为："'+i.response.statusName+'": '+i.response.statusCode,{icon:2,anim:6}):n=e[i.response.dataName]},error:function(e){layer.msg("请求异常！",{icon:2,anim:6}),C=!1}}),!C)return}else{h=h.next().children(".layui-table-box").children(".layui-table-header").find('.layui-table-sort[lay-sort$="sc"]:eq(0)');if(0<h.length){var w=h.parent().parent().data("field");switch(h.attr("lay-sort")){case"asc":n=layui.sort(n,w);break;case"desc":n=layui.sort(n,w,!0)}}}var L,S,D=[];for(T=0;T<p.length;T++)for(f=S=0;f<p[T].length;f++)if(p[T][f].exportHandled)(!p[T][f].field&&"numbers"!==p[T][f].type||p[T][f].hide)&&S++;else{if(1<p[T][f].rowspan)for(!p[T][f].field&&"numbers"!==p[T][f].type||p[T][f].hide?S++:u.push([_(f+1-S)+(T+x),_(f+1-S)+(T+parseInt(p[T][f].rowspan)+x-1)]),(L=this.deepClone(p[T][f])).exportHandled=!0,d=T+1;d<p.length;)p[d].splice(f,0,L),d++;if(1<p[T][f].colspan){for(u.push([_(f+1-S)+(T+x),_(f+parseInt(p[T][f].colspan)-S)+(T+x)]),(L=this.deepClone(p[T][f])).exportHandled=!0,d=1;d<p[T][f].colspan;d++)p[T].splice(f,0,L);f=f+parseInt(p[T][f].colspan)-1}}var N=p[p.length-1];for(T=0;T<n.length;T++)for(f=0;f<N.length;f++)(N[f].field||"numbers"===N[f].type)&&(g&&Array.isArray(g)||!N[f].hide)&&(n[T][N[f].key]=n[T][N[f].field||N[f].LAY_TABLE_INDEX]);if(!1!==o&&i.totalRow){for(var O={},T=0;T<N.length;T++)N[T].field&&(O[N[T].key]=m.find('[data-field="'+N[T].field+'"]').text().trim());n.push(O)}if(g&&Array.isArray(g)){var I=[],F={},u=[];for(D[0]={},T=0;T<g.length;T++)for(f=0;f<N.length;f++)if(N[f].field===g[T]){N[f].hide=!1,I.push(N[f]),D[0][N[f].key]=N[f],F[N[f].key]=U("<div>"+N[f].title+"</div>").text();break}N=I,n.splice(0,0,F)}else for(T=0;T<p.length;T++){for(D[T]={},F={},f=0;f<p[T].length;f++)D[T][p[p.length-1][f].key]=p[T][f],F[p[p.length-1][f].key]=U("<div>"+p[T][f].title+"</div>").text();n.splice(T,0,F)}if(v.add){var W,P,R,B=v.add.top,q=v.add.bottom;if(B&&Array.isArray(B.data)&&0<B.data.length){for(T=0;T<B.data.length;T++){for(F={},f=R=0;f<(B.data[T].length>N.length?B.data[T]:N).length;f++)!N[f].field&&"numbers"!==N[f].type||N[f].hide?R++:F[N[f]?N[f].key:f+""]=B.data[T][f-R]||"";n.splice(T,0,F)}if(Array.isArray(B.heights)&&0<B.heights.length)for(T=0;T<B.heights.length;T++)c[T]=B.heights[T];if(Array.isArray(B.merge)&&0<B.merge.length)for(T=0;T<B.merge.length;T++)2===B.merge[T].length&&(W=B.merge[T][0].split(","),P=B.merge[T][1].split(","),u.push([_(W[1])+W[0],_(P[1])+P[0]]))}if(q&&Array.isArray(q.data)&&0<q.data.length){for(T=0;T<q.data.length;T++){for(F={},f=R=0;f<(q.data[T].length>N.length?q.data[T]:N).length;f++)!N[f].field&&"numbers"!==N[f].type||N[f].hide?R++:F[N[f]?N[f].key:f+""]=q.data[T][f-R]||"";n.push(F)}if(Array.isArray(q.heights)&&0<q.heights.length)for(T=0;T<q.heights.length;T++)c[n.length-q.data.length+T]=q.heights[T];if(Array.isArray(q.merge)&&0<q.merge.length)for(T=0;T<q.merge.length;T++)2===q.merge[T].length&&(W=q.merge[T][0].split(","),P=q.merge[T][1].split(","),u.push([_(W[1])+(n.length-q.data.length+parseInt(W[0])),_(P[1])+(n.length-q.data.length+parseInt(P[0]))]))}}var j=0,A={left:"left",center:"center",right:"right"},H=["top","bottom","left","right"];for(T=0;T<N.length;T++)!N[T].field&&"numbers"!==N[T].type||N[T].hide||(N[T].width&&(r[String.fromCharCode(64+parseInt(++j))]=N[T].width),s[N[T].key]=function(e,i,t,l){var a="ffffff",o="000000",d="Calibri",n=12,s="s",r=l-(g?1:p.length)-x+1,u={top:{style:"thin",color:{indexed:64}},bottom:{style:"thin",color:{indexed:64}},left:{style:"thin",color:{indexed:64}},right:{style:"thin",color:{indexed:64}}};if(v.border)for(f=0;f<H.length;f++)v.border[H[f]]?(u[H[f]].style=v.border[H[f]].style||u[H[f]].style,u[H[f]].color=J(v.border[H[f]].color)||u[H[f]].color):(v.border.color||v.border.style)&&(u[H[f]].style=v.border.style||u[H[f]].style,u[H[f]].color=J(v.border.color)||u[H[f]].color);if(l<x-1||l>=t.length-k)return{v:i[e]||"",s:{alignment:{horizontal:"center",vertical:"center"},font:{name:d,sz:n,color:{rgb:o}},fill:{fgColor:{rgb:a,bgColor:{indexed:64}}},border:u},t:s};if(r<0)a="C7C7C7",v.head&&(a=v.head.bgColor||a,o=v.head.color||o,d=v.head.family||d,n=v.head.size||n);else{if(v.font&&(a=v.font.bgColor||a,o=v.font.color||o,d=v.font.family||d,n=v.font.size||n),v.border)for(f=0;f<H.length;f++)v.border[H[f]]?(u[H[f]].style=v.border[H[f]].style||u[H[f]].style,u[H[f]].color=J(v.border[H[f]].color)||u[H[f]].color):(v.border.color||v.border.style)&&(u[H[f]].style=v.border.style||u[H[f]].style,u[H[f]].color=J(v.border.color)||u[H[f]].color);if(D[D.length-1][e].excel){var c="function"==typeof D[D.length-1][e].excel?D[D.length-1][e].excel.call(this,i,r,t.length-p.length-x+1-k):D[D.length-1][e].excel;if(c&&(a=c.bgColor||a,o=c.color||o,d=c.family||d,n=c.size||n,s=c.cellType||s,c.border))for(f=0;f<H.length;f++)c.border[H[f]]?(u[H[f]].style=c.border[H[f]].style||u[H[f]].style,u[H[f]].color=J(c.border[H[f]].color)||u[H[f]].color):(c.border.color||c.border.style)&&(u[H[f]].style=c.border.style||u[H[f]].style,u[H[f]].color=J(c.border.color)||u[H[f]].color)}}function h(e){return null==e?"":e}i=0<=r&&D[D.length-1][e].templet?"function"==typeof D[D.length-1][e].templet?0===U("<div>"+D[D.length-1][e].templet(i)+"</div>").find(":input").length?U("<div>"+D[D.length-1][e].templet(i)+"</div>").text():y.children("tbody").children("tr[data-index="+r+"]").children('td[data-field="'+e+'"]').find(":input").val()||h(i[e]):0===U("<div>"+E(U(D[D.length-1][e].templet).html()||String(D[D.length-1][e].templet)).render(i)+"</div>").find(":input").length?U("<div>"+E(U(D[D.length-1][e].templet).html()||String(D[D.length-1][e].templet)).render(i)+"</div>").text():y.children("tbody").children("tr[data-index="+r+"]").children('td[data-field="'+e+'"]').find(":input").val()||h(i[e]):0<=r&&"numbers"===D[D.length-1][e].type?1+r:h(i[e]);return{v:i,s:{alignment:{horizontal:D[r<-1?l-x+1:D.length-1][e].align?A[D[r<-1?l-x+1:D.length-1][e].align]:"top",vertical:"center"},font:{name:d,sz:n,color:{rgb:o}},fill:{fgColor:{rgb:a,bgColor:{indexed:64}}},border:u},t:-1===G.indexOf(i)?s:"s"}});function J(e){return e&&{rgb:e}}function _(e){for(var i=[];e;){var t=e%26;t||(t=26,--e),String.fromCodePoint||function(d){function i(e){for(var i=[],t="",l=0,a=arguments.length;l!==a;++l){var o=+arguments[l];if(!(o<1114111&&o>>>0===o))throw RangeError("Invalid code point: "+o);16383<=(o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)))&&(t+=d.apply(null,i),i.length=0)}return t+d.apply(null,i)}try{Object.defineProperty(String,"fromCodePoint",{value:i,configurable:!0,writable:!0})}catch(e){String.fromCodePoint=i}}(String.fromCharCode),i.push(String.fromCodePoint(t+64)),String.fromCodePoint||function(d){function i(e){for(var i=[],t="",l=0,a=arguments.length;l!==a;++l){var o=+arguments[l];if(!(o<1114111&&o>>>0===o))throw RangeError("Invalid code point: "+o);16383<=(o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)))&&(t+=d.apply(null,i),i.length=0)}return t+d.apply(null,i)}try{Object.defineProperty(String,"fromCodePoint",{value:i,configurable:!0,writable:!0})}catch(e){String.fromCodePoint=i}}(String.fromCharCode),e=~~(e/26)}return i.reverse().join("")}Y.exportExcel({sheet1:Y.filterExportData(n,s)},b,e,{extend:{"!cols":Y.makeColConfig(r,80),"!merges":Y.makeMergeConfig(u),"!rows":Y.makeRowConfig(c,16)}}),layer.close(t)},startsWith:function(e,i){i=new RegExp("^"+i);return e&&i.test(e)},deepClone:function(e){var i=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e&&"object"==typeof e[t]?this.deepClone(e[t]):e[t]);return i},deepStringify:function(e){var t="[[JSON_FUN_PREFIX_",l="_JSON_FUN_SUFFIX]]";return JSON.stringify(e,function(e,i){return"function"==typeof i?t+i.toString()+l:i})},getScrollWidth:function(e){var i=0;return e?i=e.offsetWidth-e.clientWidth:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowY="scroll",document.body.appendChild(e),i=e.offsetWidth-e.clientWidth,document.body.removeChild(e)),i},getCompleteCols:function(e){for(var i,t,l,a=this.deepClone(e),o=0;o<a.length;o++)for(i=0;i<a[o].length;i++)if(!a[o][i].exportHandled){if(1<a[o][i].rowspan)for((l=this.deepClone(a[o][i])).exportHandled=!0,t=o+1;t<a.length;)a[t].splice(i,0,l),t++;if(1<a[o][i].colspan){for((l=this.deepClone(a[o][i])).exportHandled=!0,t=1;t<a[o][i].colspan;t++)a[o].splice(i,0,l);i=i+parseInt(a[o][i].colspan)-1}}return a[a.length-1]},parseTempData:function(e,i,t,l){i=e.templet?"function"==typeof e.templet?e.templet(t):E(U(e.templet).html()||String(i)).render(t):i;return l?U("<div>"+i+"</div>").text():i},cache:M})});